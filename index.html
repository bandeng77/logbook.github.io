<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Buku Tamu</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
    crossorigin="anonymous"
    referrerpolicy="no-referrer"
  />
  <!-- Tambahkan Google Fonts untuk tipografi yang lebih baik -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary-color: #4a6cf7; /* Biru cerah */
      --secondary-color: #6a5acd; /* Ungu */
      --accent-color: #7FFFD4; /* Hijau mint */
      --text-color: #333;
      --light-text-color: #666;
      --border-color: rgba(0,0,0,0.1);
      --bg-light: rgba(255,255,255,0.95);
      --shadow-light: 0 8px 32px rgba(31, 38, 135, 0.15);
      --shadow-hover: 0 12px 40px rgba(31, 38, 135, 0.25);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, var(--accent-color) 0%, #c3cfe2 100%); /* Gradien latar belakang */
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
      color: var(--text-color);
    }

    .container {
      display: flex;
      flex-direction: row;
      gap: 40px;
      background: var(--bg-light);
      padding: 40px;
      border-radius: 20px; /* Sudut lebih membulat */
      box-shadow: var(--shadow-light);
      max-width: 1100px; /* Sedikit lebih lebar */
      width: 100%;
      border: 1px solid rgba(255,255,255,0.3); /* Border transparan */
      backdrop-filter: blur(10px); /* Efek glassmorphism */
      transition: all 0.3s ease;
    }

    .container:hover {
      box-shadow: var(--shadow-hover);
    }

    .form-wrapper, .camera-wrapper {
      flex: 1;
      max-width: 550px; /* Sesuaikan max-width */
      display: flex;
      flex-direction: column;
      justify-content: center;
    }

    .camera-wrapper {
      text-align: center;
      padding-left: 20px; /* Sedikit padding untuk pemisah visual */
      border-left: 1px solid var(--border-color); /* Garis pemisah */
    }

    img.logo {
      display: block;
      margin: 0 auto 25px; /* Margin lebih besar */
      max-width: 200px; /* Ukuran logo sedikit lebih besar */
      filter: drop-shadow(0 4px 8px rgba(0,0,0,0.1)); /* Bayangan pada logo */
    }

    h2 {
      text-align: center;
      margin-top: 0;
      margin-bottom: 30px; /* Margin lebih besar */
      font-size: 28px; /* Ukuran font lebih besar */
      color: var(--primary-color);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }

    h2 i {
      color: var(--secondary-color);
    }

    input, textarea, select {
      width: 100%;
      padding: 15px; /* Padding lebih besar */
      margin-bottom: 20px; /* Margin lebih besar */
      font-size: 16px;
      border-radius: 10px; /* Sudut lebih membulat */
      border: 1px solid var(--border-color);
      background-color: rgba(255,255,255,0.7); /* Background input transparan */
      transition: all 0.3s ease;
      color: var(--text-color);
    }

    input::placeholder, textarea::placeholder, select option[disabled] {
      color: var(--light-text-color);
      opacity: 0.8;
    }

    input:focus, textarea:focus, select:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(74, 108, 247, 0.2); /* Bayangan fokus */
      background-color: white;
    }

    select {
      appearance: none; /* Hapus gaya default select */
      -webkit-appearance: none;
      -moz-appearance: none;
      background-image: url('data:image/svg+xml;utf8,<svg fill="%23333" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M7 10l5 5 5-5z"/><path d="M0 0h24v24H0z" fill="none"/></svg>');
      background-repeat: no-repeat;
      background-position: right 15px center;
      background-size: 20px;
    }

    button {
      width: 100%;
      padding: 15px;
      font-size: 18px; /* Ukuran font lebih besar */
      font-weight: 600; /* Lebih tebal */
      border-radius: 10px;
      border: none;
      cursor: pointer;
      background: linear-gradient(to right, var(--primary-color), var(--secondary-color)); /* Gradien tombol */
      color: white;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1); /* Bayangan tombol */
    }

    button:hover {
      transform: translateY(-3px); /* Efek angkat */
      box-shadow: 0 8px 20px rgba(0,0,0,0.2);
    }

    video {
      width: 100%;
      max-width: 100%;
      border-radius: 12px; /* Sudut lebih membulat */
      margin: 15px auto; /* Margin lebih besar */
      display: block;
      transform: scaleX(-1); /* Mirror camera view */
      box-shadow: 0 4px 15px rgba(0,0,0,0.1); /* Bayangan pada video */
    }

    #preview {
      width: 100%;
      max-width: 100%;
      border-radius: 12px;
      margin: 15px auto;
      display: none;
      object-fit: cover;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }

    canvas {
      display: none;
    }

    /* Responsive Design */
    @media (max-width: 992px) {
      .container {
        flex-direction: column;
        gap: 30px;
        padding: 30px;
        max-width: 600px; /* Batasi lebar pada tablet */
      }

      .camera-wrapper {
        border-left: none; /* Hapus garis pemisah */
        padding-left: 0;
        padding-top: 30px; /* Tambah padding atas */
        border-top: 1px solid var(--border-color); /* Garis pemisah horizontal */
      }

      img.logo {
        max-width: 180px;
      }

      h2 {
        font-size: 24px;
        margin-bottom: 25px;
      }

      input, textarea, select, button {
        padding: 12px;
        margin-bottom: 15px;
        font-size: 15px;
      }

      video, #preview {
        max-height: 300px;
      }
    }

    @media (max-width: 576px) {
      body {
        padding: 15px;
      }

      .container {
        padding: 25px;
        border-radius: 15px;
      }

      img.logo {
        max-width: 150px;
        margin-bottom: 20px;
      }

      h2 {
        font-size: 22px;
        margin-bottom: 20px;
      }

      input, textarea, select, button {
        padding: 10px;
        font-size: 14px;
        border-radius: 8px;
      }

      video, #preview {
        max-height: 240px;
        margin: 10px auto;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="form-wrapper">
      <img src="genetek-logo.png" alt="Genetek Logo" class="logo" />
      <h2><i class="fas fa-book"></i> Buku Tamu</h2>
      <form id="logForm">
        <input type="text" id="tanggal" required readonly style="pointer-events: none; background-color: rgba(245,245,245,0.7);" />
        <input type="text" id="nama" placeholder="Nama Lengkap" required />
        <input type="text" id="perusahaan" placeholder="Nama Perusahaan" required />
        <input type="text" id="alamat" placeholder="Alamat Perusahaan" required />
        <input type="tel" id="telepon" placeholder="Nomor Telepon (cth: 081234567890)" required />
        <select id="tujuan" required>
          <option value="" disabled selected>Pilih Tujuan Kunjungan</option>
          <option value="Antar Dokumen">Antar Dokumen</option>
          <option value="Ambil Dokumen">Ambil Dokumen</option>
          <option value="Antar Barang">Antar Barang</option>
          <option value="Ambil Barang">Ambil Barang</option>
          <option value="Antar Dokumen dan Barang">Antar Dokumen dan Barang</option>
          <option value="Kunjungan">Kunjungan</option>
          <option value="Lain-lain">Lain-lain</option>
        </select>
        <input type="text" id="deskripsi" placeholder="Deskripsi Singkat Kunjungan (cth: Bertemu Bpk. Andi)" required />
        <button type="submit"><i class="fas fa-plus-circle"></i> Tambah ke Buku Tamu</button>
      </form>
    </div>

    <div class="camera-wrapper">
      <video id="video" autoplay></video>
      <button type="button" onclick="takePhoto()">ðŸ“¸ Ambil Foto</button>
      <canvas id="canvas"></canvas>
      <img id="preview" alt="Preview Foto" />
    </div>
  </div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyC8LlcI_ccRGieFNjlVFLfEr2c4PBg6J70", // Ganti dengan API Key Anda
      authDomain: "logbook-e6ab3.firebaseapp.com", // Ganti dengan Auth Domain Anda
      projectId: "logbook-e6ab3", // Ganti dengan Project ID Anda
      storageBucket: "logbook-e6ab3.appspot.com", // Ganti dengan Storage Bucket Anda
      messagingSenderId: "484546392348", // Ganti dengan Messaging Sender ID Anda
      appId: "1:484546392348:web:861616b680427c158ecad9" // Ganti dengan App ID Anda
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    const video = document.getElementById('video');
    const canvas = document.getElementById('canvas');
    const context = canvas.getContext('2d');
    const preview = document.getElementById('preview');
    let photoData = ''; // Akan menyimpan Base64 string dari foto

    // Fungsi untuk memperbarui tanggal dan waktu secara real-time
    function updateDateTimeRealtime() {
      setInterval(() => {
        const now = new Date();
        const year = now.getFullYear();
        const month = String(now.getMonth() + 1).padStart(2, '0');
        const day = String(now.getDate()).padStart(2, '0');
        const hours = String(now.getHours()).padStart(2, '0');
        const minutes = String(now.getMinutes()).padStart(2, '0');
        const seconds = String(now.getSeconds()).padStart(2, '0');

        const formattedTime = `${year}-${month}-${day} ${hours}:${minutes}:${seconds}`;
        document.getElementById('tanggal').value = formattedTime;
      }, 1000);
    }

    // Panggil fungsi updateDateTimeRealtime saat halaman dimuat
    window.onload = () => {
      updateDateTimeRealtime();
    };

    // Meminta akses kamera
    navigator.mediaDevices.getUserMedia({ video: true })
      .then(stream => video.srcObject = stream)
      .catch(err => console.error('Akses kamera ditolak:', err));

    // Fungsi untuk mengambil foto dari kamera
    function takePhoto() {
      canvas.width = video.videoWidth;
      canvas.height = video.videoHeight;

      context.save();
      context.scale(-1, 1); // Mirror the image horizontally
      context.drawImage(video, -canvas.width, 0, canvas.width, canvas.height);
      context.restore();

      // Ambil data gambar sebagai Base64 string (kualitas 30%)
      // Kualitas rendah sangat disarankan untuk mengurangi ukuran data
      photoData = canvas.toDataURL('image/jpeg', 0.3);
      preview.src = photoData;
      preview.style.display = 'block';
    }

    // Handler saat formulir disubmit
    document.getElementById('logForm').onsubmit = function(e) {
      e.preventDefault();

      if (!photoData) {
        alert("Silakan ambil foto terlebih dahulu sebelum submit.");
        return;
      }

      const tanggal = document.getElementById('tanggal').value;
      const nama = document.getElementById('nama').value;
      const perusahaan = document.getElementById('perusahaan').value;
      const alamat = document.getElementById('alamat').value;
      const telepon = document.getElementById('telepon').value;
      const tujuan = document.getElementById('tujuan').value;
      const deskripsi = document.getElementById('deskripsi').value;

      // Data yang akan disimpan di Firestore, termasuk foto Base64
      const dataToFirestore = {
        tanggal,
        nama,
        perusahaan,
        alamat,
        telepon,
        tujuan,
        deskripsi,
        foto: photoData
      };

      db.collection("logbook").add(dataToFirestore)
        .then(() => {
          alert("Data berhasil disimpan di Firestore");
          // Reset formulir dan tampilan setelah berhasil
          document.getElementById('logForm').reset();
          photoData = ''; // Kosongkan data foto
          preview.src = ''; // Kosongkan preview
          preview.style.display = 'none'; // Sembunyikan preview
        })
        .catch(err => {
          console.error("Gagal menyimpan data:", err);
          alert("Gagal menyimpan data: " + err.message);
        });
    };
  </script>
</body>
</html>
